# CLAUDE.md - 智能文档处理系统

## 项目简介
这是一个基于Claude Code驱动的智能文档处理应用，专门用于将多个markdown文档进行无损合并、智能去重，并生成深度理解总结报告。本项目无需安装任何MCP工具，无需编写代码，完全基于Claude Code的内置能力。

## 核心架构

### 系统组件
- **文档分析器** (prompts/document_analyzer.md) - 分析文档结构和内容关联
- **智能合并引擎** (prompts/merger_engine.md) - 执行无损合并和去重
- **总结报告生成器** (prompts/summary_generator.md) - 生成深度理解报告
- **完整工作流** (workflows/complete_process.md) - 端到端处理流程

### 数据流向
```
docs/input/ → 文档分析 → 智能合并 → 总结生成 → docs/output/
```

## 关键技术策略

### 上下文窗口管理
处理大文件时的策略：

1. **分块读取**：将大文档按章节分割处理
2. **渐进式合并**：逐步完成阅读文档-理解文档-输出合并内容到output目录的过程，避免上下文窗口溢出
3. **摘要技术**：对超长内容先生成摘要再处理
4. **优先级处理**：重要内容优先保留和处理

### 智能去重算法
1. **语义相似度检测**：基于内容理解的重复识别
2. **结构化比较**：标题、段落、列表的结构对比
3. **保留策略**：优先保留信息更完整、表达更清晰的版本
4. **合并策略**：将部分重复内容的独特部分进行合并

### 格式标准化
1. **统一标题层级**：H1-H6的规范使用
2. **表格格式化**：统一表格样式和对齐
3. **列表规范化**：统一有序和无序列表格式
4. **代码块处理**：保持代码完整性和语法高亮

## 操作指南

### 基础操作流程
1. **准备阶段**：将markdown文档放入 `docs/input/`
2. **分析阶段**：使用 "分析输入目录中的所有文档"
3. **合并阶段**：使用 "执行智能文档合并"
4. **总结阶段**：使用 "生成文档处理总结报告"

### 高级操作指令
```
# 自定义合并策略
使用保守合并策略处理文档
使用激进去重策略处理文档

# 批量处理
批量处理所有文档，分组按主题合并

# 质量控制
执行质量检查，生成改进建议
验证合并结果的完整性和准确性

# 特定主题处理
专门处理技术文档，保留所有代码示例
专门处理会议记录，按时间线组织
```

## 错误处理机制

### 常见问题及解决方案

1. **文件读取失败**
   - 检查文件编码（推荐UTF-8）
   - 验证文件权限
   - 确认文件路径正确

2. **内存不足问题**
   - 启用分块处理模式
   - 减少同时处理的文档数量
   - 使用摘要模式预处理

3. **格式冲突**
   - 自动检测并报告格式问题
   - 提供格式修复建议
   - 生成格式规范化报告

4. **内容丢失风险**
   - 自动备份原始文档
   - 记录所有合并决策
   - 提供可追溯的操作日志

### 质量保证策略

1. **完整性检查**
   - 验证所有原始信息是否保留
   - 检查章节逻辑连贯性
   - 确认格式规范统一

2. **准确性验证**
   - 对比原始文档与合并结果
   - 验证技术内容的准确性
   - 检查链接和引用有效性

3. **可读性优化**
   - 优化章节结构和顺序
   - 统一术语和表达方式
   - 改善整体文档流畅度

## 性能优化

### 处理速度优化
1. **并行处理**：同时分析多个文档
2. **缓存机制**：重复内容识别缓存
3. **增量处理**：只处理变更的内容
4. **优先级队列**：重要内容优先处理

### 内存使用优化
1. **流式处理**：边读边处理，避免全量加载
2. **垃圾回收**：及时清理临时数据
3. **数据压缩**：压缩存储中间结果
4. **分页机制**：大文档分页处理

## 扩展性设计

### 可配置项
- 相似度阈值调整
- 合并策略选择
- 输出格式定制
- 质量检查级别

### 自定义扩展
```
# 添加自定义分析维度
"增加代码质量分析维度"
"增加文档可读性评估"

# 自定义输出格式
"生成HTML格式的合并文档"
"生成PDF格式的总结报告"

# 集成外部工具
"集成Pandoc进行格式转换"
"集成语法检查工具"
```

## 最佳实践建议

### 输入准备
1. **文档质量**：确保输入文档格式正确、内容完整
2. **命名规范**：使用有意义的文件名便于理解关联
3. **主题相关**：相关主题的文档放在一起处理效果更好

### 处理策略
1. **分批处理**：大量文档建议分批处理
2. **渐进优化**：先快速合并，再精细调优
3. **版本控制**：保留处理过程中的重要版本

### 结果验证
1. **人工审阅**：重要文档建议人工审阅关键部分
2. **专家验证**：技术内容建议专业人员验证
3. **用户测试**：面向最终用户的可用性测试

## 故障恢复

### 备份策略
- 自动备份原始文档到 `docs/backup/`
- 保存处理过程中的中间结果
- 记录详细的操作日志

### 回滚机制
- 支持从任意处理阶段恢复
- 提供差异对比功能
- 保留多个版本的处理结果

### 灾难恢复
- 从备份快速恢复原始状态
- 重新执行失败的处理步骤
- 提供数据完整性验证

---

## 重要提醒

1. **数据安全**：处理敏感文档时注意信息保护
2. **版本管理**：重要文档建议使用版本控制
3. **定期备份**：定期备份处理结果和配置
4. **性能监控**：关注处理性能和资源使用
5. **质量评估**：定期评估输出质量并优化策略

本系统设计为完全自动化的文档处理解决方案，通过自然语言指令即可完成复杂的文档合并和分析任务。